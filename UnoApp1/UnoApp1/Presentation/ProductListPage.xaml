<Page x:Class="UnoApp1.Presentation.ProductListPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:models="using:UnoApp1.Models"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      uen:Region.Attached="True"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header với gradient background -->
        <Grid Grid.Row="0" Padding="20,16">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="{ThemeResource SystemAccentColor}" Offset="0"/>
                    <GradientStop Color="{ThemeResource SystemAccentColorLight1}" Offset="1"/>
                </LinearGradientBrush>
            </Grid.Background>

            <StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                    <FontIcon Glyph="&#xE7BF;" FontSize="28" Foreground="White"/>
                    <TextBlock Text="Danh sách sản phẩm"
                              FontSize="28"
                              FontWeight="Bold"
                              Foreground="White"
                              VerticalAlignment="Center"/>
                </StackPanel>
                <TextBlock Text="Chọn sản phẩm để thêm vào giỏ hàng"
                          FontSize="14"
                          Foreground="White"
                          Opacity="0.9"/>
            </StackPanel>
        </Grid>

        <!-- Search và Filter Bar -->
        <Grid Grid.Row="1" Padding="16,12" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Search Box -->
            <TextBox Grid.Column="0"
                    PlaceholderText="Tìm kiếm sản phẩm..."
                    Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0">
                <TextBox.Resources>
                    <Style TargetType="TextBox" BasedOn="{StaticResource DefaultTextBoxStyle}">
                        <Setter Property="FontFamily" Value="Segoe UI"/>
                    </Style>
                </TextBox.Resources>
            </TextBox>

            <!-- Refresh Button -->
            <Button Grid.Column="1"
                   Command="{Binding LoadProductsCommand}"
                   VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal">
                    <FontIcon Glyph="&#xE149;" FontSize="16" Margin="0,0,8,0"/>
                    <TextBlock Text="Làm mới"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Content Area -->
        <Grid Grid.Row="2" Padding="16,8">
            <!-- Loading Indicator -->
            <Grid Visibility="{Binding IsBusy, Converter={StaticResource TrueToVisible}}"
                 Background="{ThemeResource LayerFillColorDefaultBrush}"
                 Opacity="0.8">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                    <ProgressRing IsActive="True" Width="60" Height="60"/>
                    <TextBlock Text="Đang tải sản phẩm..."
                              Style="{StaticResource SubtitleTextBlockStyle}"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- Error Message -->
            <StackPanel Visibility="{Binding ErrorMessage, Converter={StaticResource EmptyToCollapsed}}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Spacing="16"
                       Padding="32">
                <FontIcon Glyph="&#xE783;"
                         FontSize="64"
                         Foreground="{ThemeResource SystemErrorTextColor}"/>
                <TextBlock Text="{Binding ErrorMessage}"
                          Foreground="{ThemeResource SystemErrorTextColor}"
                          TextWrapping="Wrap"
                          TextAlignment="Center"
                          Style="{StaticResource SubtitleTextBlockStyle}"/>
                <Button Content="Thử lại"
                       Command="{Binding LoadProductsCommand}"
                       HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- Product Grid -->
            <ScrollViewer Visibility="{Binding IsBusy, Converter={StaticResource TrueToCollapsed}}">
                <ItemsRepeater ItemsSource="{Binding FilteredProducts}">
                    <ItemsRepeater.Layout>
                        <UniformGridLayout MinItemWidth="300"
                                         MinItemHeight="200"
                                         ItemsStretch="Fill"
                                         MinColumnSpacing="12"
                                         MinRowSpacing="12"/>
                    </ItemsRepeater.Layout>

                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="models:Product">
                            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                 CornerRadius="12"
                                 Padding="16"
                                 BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                 BorderThickness="1"
                                 MinHeight="180">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Product Image Placeholder -->
                                <Border Grid.Row="0" Grid.Column="0" Grid.RowSpan="4"
                                       Width="70" Height="70"
                                       CornerRadius="8"
                                       Margin="0,0,12,0"
                                       VerticalAlignment="Top">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="{ThemeResource SystemAccentColorLight2}" Offset="0"/>
                                            <GradientStop Color="{ThemeResource SystemAccentColorLight3}" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <FontIcon Glyph="&#xE7B8;"
                                             FontSize="32"
                                             Foreground="White"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"/>
                                </Border>

                                <!-- Product Name -->
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                          Text="{x:Bind ProductName}"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          TextWrapping="Wrap"
                                          MaxLines="2"
                                          TextTrimming="CharacterEllipsis"
                                          Margin="0,0,0,6"/>

                                <!-- Category -->
                                <StackPanel Grid.Row="1" Grid.Column="1"
                                           Orientation="Horizontal"
                                           Spacing="4"
                                           Margin="0,0,0,4">
                                    <FontIcon Glyph="&#xE8F1;"
                                             FontSize="12"
                                             Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock FontSize="13"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                              Text="{x:Bind Category.CategoryName, FallbackValue='N/A'}"/>
                                </StackPanel>

                                <!-- Unit -->
                                <StackPanel Grid.Row="2" Grid.Column="1"
                                           Orientation="Horizontal"
                                           Spacing="4"
                                           Margin="0,0,0,4">
                                    <FontIcon Glyph="&#xE81E;"
                                             FontSize="12"
                                             Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock FontSize="13"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                        <Run Text="Đơn vị:"/>
                                        <Run Text="{x:Bind Unit}" FontWeight="SemiBold"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Barcode -->
                                <StackPanel Grid.Row="3" Grid.Column="1"
                                           Orientation="Horizontal"
                                           Spacing="4"
                                           VerticalAlignment="Top"
                                           Margin="0,0,0,8">
                                    <FontIcon Glyph="&#xED14;"
                                             FontSize="11"
                                             Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                    <TextBlock FontSize="12"
                                              Foreground="{ThemeResource TextFillColorTertiaryBrush}">
                                        <Run Text="Mã:"/>
                                        <Run Text="{x:Bind Barcode}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Price and Action Button -->
                                <Grid Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                     Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Price -->
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <TextBlock FontSize="18" FontWeight="Bold">
                                            <Run Text="{x:Bind Price, Converter={StaticResource DecimalToString}}"
                                                 Foreground="{ThemeResource SystemAccentColor}"/>
                                            <Run Text=" ₫"
                                                 FontSize="14"
                                                 Foreground="{ThemeResource SystemAccentColor}"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- Add to Cart Button -->
                                    <Button Grid.Column="1"
                                           CornerRadius="8"
                                           Padding="12,6"
                                           IsEnabled="False"
                                           ToolTipService.ToolTip="Tính năng sẽ có ở Tuần 2">
                                        <StackPanel Orientation="Horizontal">
                                            <FontIcon Glyph="&#xE7BF;" FontSize="14" Margin="0,0,4,0"/>
                                            <TextBlock Text="Thêm" FontSize="13"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </ScrollViewer>

            <!-- Empty State -->
            <StackPanel Visibility="{Binding IsEmpty, Converter={StaticResource TrueToVisible}}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Spacing="16"
                       Padding="32">
                <FontIcon Glyph="&#xE7C5;"
                         FontSize="64"
                         Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="Không có sản phẩm nào"
                          Style="{StaticResource SubtitleTextBlockStyle}"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                          HorizontalAlignment="Center"/>
                <Button Content="Tải lại"
                       Command="{Binding LoadProductsCommand}"
                       HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>

